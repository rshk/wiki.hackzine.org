<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Linux: Basic LUKS usage &mdash; Hackzine Wiki</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Hackzine Wiki" href="../index.html" />
    <link rel="up" title="Sysadmin" href="index.html" />
    <link rel="next" title="OpenSSL Basics and commands" href="openssl-commands.html" />
    <link rel="prev" title="Linux: printing manpages" href="linux-printing-manpages.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="openssl-commands.html" title="OpenSSL Basics and commands"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="linux-printing-manpages.html" title="Linux: printing manpages"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Hackzine Wiki</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Sysadmin</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            

  <div class="section" id="linux-basic-luks-usage">
<h1>Linux: Basic LUKS usage<a class="headerlink" href="#linux-basic-luks-usage" title="Permalink to this headline">¶</a></h1>
<p><strong>See also:</strong> <a class="reference external" href="http://www.hackzine.org/minimal-luks-guide.html">http://www.hackzine.org/minimal-luks-guide.html</a></p>
<p>These are just the basic commands I usually use to create encrypted partitions
using LUKS.</p>
<div class="section" id="the-commands">
<h2>The commands<a class="headerlink" href="#the-commands" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>fdisk /dev/sdx
cryptsetup -y --cipher aes-cbc-essiv:sha256 --key-size 256 luksFormat /dev/sdx1
cryptsetup luksOpen /dev/sdx1 crypt_sdx1
mkfs.ext3 -m 0 -j -O dir_index,filetype,sparse_super /dev/mapper/crypt_sdx1
tune2fs -m 0 -c 0 -i 0 -L label /dev/mapper/crypt_sdx1
mount /dev/mapper/crypt_sdx1 /mnt/crypt_sdx1
umount /dev/mapper/crypt_sdx1
cryptsetup luksClose crypt_sdx1
</pre></div>
</div>
</div>
<div class="section" id="commands-explained">
<h2>Commands explained<a class="headerlink" href="#commands-explained" title="Permalink to this headline">¶</a></h2>
<p>This part includes just some output of the commands and some comments,
not really more. But I promise I will write a full guide one day..
I wrote this just as a reminder.</p>
<p>First of all, setup the partitioning using fdisk:</p>
<div class="highlight-python"><div class="highlight"><pre># fdisk /dev/sdx
Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel
Building a new DOS disklabel with disk identifier 0x87cd9031.
Changes will remain in memory only, until you decide to write them.
After that, of course, the previous content won&#39;t be recoverable.


The number of cylinders for this disk is set to 182401.
There is nothing wrong with that, but this is larger than 1024,
and could in certain setups cause problems with:
1) software that runs at boot time (e.g., old versions of LILO)
2) booting and partitioning software from other OSs
   (e.g., DOS FDISK, OS/2 FDISK)
Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)

Command (m for help): p

Disk /dev/sdx: 1500.3 GB, 1500301910016 bytes
255 heads, 63 sectors/track, 182401 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Disk identifier: 0x87cd9031

   Device Boot      Start         End      Blocks   Id  System

Command (m for help): o
Building a new DOS disklabel with disk identifier 0x84732589.
Changes will remain in memory only, until you decide to write them.
After that, of course, the previous content won&#39;t be recoverable.


The number of cylinders for this disk is set to 182401.
There is nothing wrong with that, but this is larger than 1024,
and could in certain setups cause problems with:
1) software that runs at boot time (e.g., old versions of LILO)
2) booting and partitioning software from other OSs
   (e.g., DOS FDISK, OS/2 FDISK)
Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)

Command (m for help): n
Command action
   e   extended
   p   primary partition (1-4)
p
Partition number (1-4): 1
First cylinder (1-182401, default 1): 1
Last cylinder, +cylinders or +size{K,M,G} (1-182401, default 182401): 182401

Command (m for help): p

Disk /dev/sdx: 1500.3 GB, 1500301910016 bytes
255 heads, 63 sectors/track, 182401 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Disk identifier: 0x84732589

   Device Boot      Start         End      Blocks   Id  System
/dev/sdx1               1      182401  1465136001   83  Linux

Command (m for help): w
The partition table has been altered!

Calling ioctl() to re-read partition table.
Syncing disks.
</pre></div>
</div>
<p>Once the partitioning is done, we proceed setting up the encryption for the
selected partition:</p>
<div class="highlight-python"><div class="highlight"><pre># cryptsetup -y --cipher aes-cbc-essiv:sha256 --key-size 256 luksFormat /dev/sdx1
WARNING!
========
This will overwrite data on /dev/sdx1 irrevocably.

Are you sure? (Type uppercase yes): YES
Enter LUKS passphrase:
Verify passphrase:
Command successful.
</pre></div>
</div>
<p>Decrypt the partition to use it as a normal device:</p>
<div class="highlight-python"><div class="highlight"><pre># cryptsetup luksOpen /dev/sdx1 crypt_sdx1
Enter LUKS passphrase:
key slot 0 unlocked.
Command successful.
</pre></div>
</div>
<p>Create an ext3 filesystem on the partition:</p>
<div class="highlight-python"><div class="highlight"><pre># mkfs.ext3 -m 0 -j -O dir_index,filetype,sparse_super /dev/mapper/crypt_sdx1
mke2fs 1.41.9 (22-Aug-2009)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
91578368 inodes, 366283743 blocks
0 blocks (0.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=4294967296
11179 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks:
    32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,
    4096000, 7962624, 11239424, 20480000, 23887872, 71663616, 78675968,
    102400000, 214990848

Writing inode tables: done
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done

This filesystem will be automatically checked every 20 mounts or
180 days, whichever comes first.  Use tune2fs -c or -i to override.
</pre></div>
</div>
<p>I usually change some options on the filesystem, such as disable automatick
fsck and remove reserved blocks for non-root filesystems:</p>
<div class="highlight-python"><div class="highlight"><pre># tune2fs -m 0 -c 0 -i 0 -L label /dev/mapper/crypt_sdx1
tune2fs 1.41.9 (22-Aug-2009)
Setting maximal mount count to -1
Setting interval between checks to 0 seconds
Setting reserved blocks percentage to 0% (0 blocks)
</pre></div>
</div>
<p>Mount the filesystem somewhere:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># mount /dev/mapper/crypt_sdXN /mnt/crypt_sdx1</span>
</pre></div>
</div>
<p>To umount and close it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># umount /dev/mapper/crypt_sdx1</span>
<span class="c"># cryptsetup luksClose crypt_sdx1</span>
</pre></div>
</div>
</div>
</div>


    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'hackzinewiki'; // required: replace example with your forum shortname
        var disqus_identifier = "sysadmin/linux-using-luks";
	var disqus_title = "Hackzine Wiki";

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Linux: Basic LUKS usage</a><ul>
<li><a class="reference internal" href="#the-commands">The commands</a></li>
<li><a class="reference internal" href="#commands-explained">Commands explained</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="linux-printing-manpages.html"
                        title="previous chapter">Linux: printing manpages</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="openssl-commands.html"
                        title="next chapter">OpenSSL Basics and commands</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/sysadmin/linux-using-luks.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="openssl-commands.html" title="OpenSSL Basics and commands"
             >next</a> |</li>
        <li class="right" >
          <a href="linux-printing-manpages.html" title="Linux: printing manpages"
             >previous</a> |</li>
        <li><a href="../index.html">Hackzine Wiki</a> &raquo;</li>
          <li><a href="index.html" >Sysadmin</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012-2014, Samuele ~redShadow~ Santi.
      Last updated on 2014-03-19 17:19:36 +0100.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>